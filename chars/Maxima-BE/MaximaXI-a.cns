ゲージ
[statedef 20000]
Type    = A
movetype= I
Physics = N
anim = 25000

[state 20000]
type = nothitby
trigger1 = 1
value = SCA

;--------------------------------------------------------
;1P側パワーゲージ
[State 20000]
type = Explod
trigger1 = teamside = 1
anim = 20050
id = 20050
sprpriority = 8
postype = left
pos = 99,230+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = ifelse(power=powerMAX,0.5,(0.05*(power%1000)/100)),0.6

;--------------------------------------------------------
;2P側パワーゲージ
[State 20000]
type = Explod
trigger1 = teamside = 2
anim = 20060
id = 20060
sprpriority = 8
postype = right
pos = -100,230+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = ifelse(power=powerMAX,0.5,(0.05*(power%1000)/100)),0.6

;--------------------------------------------------------
;1P側スキルゲージ

;1ゲージ
[State 20000]
type = Explod
triggerall = root,var(25) < 2000
trigger1 = teamside = 1
anim = 20100
id = 20100
sprpriority = 8
postype = left
pos = 77,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = ifelse(root,var(25)>=1000,0.52,(0.05*(root,var(25)%1000)/100)),0.5

;2ゲージ
[State 20000]
type = Explod
triggerall = root,var(25) > 1000
trigger1 = teamside = 1
anim = 20101
id = 20101
sprpriority = 8
postype = left
pos = 77,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = ifelse(root,var(25)>=2000,0.52,(0.05*(root,var(25)%1000)/100)),0.5

;MAX
[State 20000]
type = Explod
triggerall = root,var(25) >= 2000
triggerall = numexplod(20202) = 0
trigger1 = teamside = 1
anim = 20102
id = 20102
sprpriority = 9
postype = left
pos = 77,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.52,0.5

;--------------------------------------------------------
;2P側スキルゲージ

;1ゲージ
[State 20000]
type = Explod
triggerall = root,var(25) < 2000
trigger1 = teamside = 2
anim = 20110
id = 20110
sprpriority = 8
postype = right
pos = -79,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = ifelse(root,var(25)>=1000,0.52,(0.05*(root,var(25)%1000)/100)),0.5

;2ゲージ
[State 20000]
type = Explod
triggerall = root,var(25) > 1000
trigger1 = teamside = 2
anim = 20111
id = 20111
sprpriority = 8
postype = right
pos = -79,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = ifelse(root,var(25)>=2000,0.52,(0.05*(root,var(25)%1000)/100)),0.5

;MAX
[State 20000]
type = Explod
triggerall = root,var(25) >= 2000
triggerall = numexplod(20112) = 0
trigger1 = teamside = 2
anim = 20112
id = 20112
sprpriority = 9
postype = right
pos = -79,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.52,0.5

;----------------------------------
;黒
[State 20000]
type = Explod
trigger1 = teamside = 1
anim = 20001
id = 20001
sprpriority = 9
postype = left
pos = 0,215+var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.5,0.5

[State 20000]
type = Explod
trigger1 = teamside = 2
anim = 20006
id = 20006
sprpriority = 9
postype = right
pos = -103,215+var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.5,0.5

;----------------------------------
;スキルゲージ球

;スキル1球
[State 20000]
type = Explod
triggerall = root,var(25) = [1000,2000]
trigger1 = teamside = 1
anim = 20200+2*(root,var(25)>=2000)
id = 20200
sprpriority = 8
postype = left
pos = 30,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;スキル1球
[State 20000]
type = Explod
triggerall = root,var(25) = [1000,2000]
trigger1 = teamside = 2
anim = 20200+2*(root,var(25)>=2000)
id = 20200
sprpriority = 8
postype = right
pos = -33,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;スキル1球白
[State 20000]
type = Explod
triggerall = root,var(25) = [1000,2000]
triggerall = numexplod(20201) = 0
trigger1 = teamside = 1
anim = 20201+2*(root,var(25)>=2000)
id = 20201
sprpriority = 8
postype = left
pos = 30,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;スキル1球白
[State 20000]
type = Explod
triggerall = root,var(25) = [1000,2000]
triggerall = numexplod(20201) = 0
trigger1 = teamside = 2
anim = 20201+2*(root,var(25)>=2000)
id = 20201
sprpriority = 8
postype = right
pos = -33,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;スキル2球
[State 20000]
type = Explod
triggerall = root,var(25) >= 2000
trigger1 = teamside = 1
anim = 20200+2*(root,var(25)>=2000)
id = 20200
sprpriority = 8
postype = left
pos = 24,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;スキル2球
[State 20000]
type = Explod
triggerall = root,var(25) >= 2000
trigger1 = teamside = 2
anim = 20200+2*(root,var(25)>=2000)
id = 20200
sprpriority = 8
postype = right
pos = -27,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;スキル2球白
[State 20000]
type = Explod
triggerall = root,var(25) >= 2000
triggerall = numexplod(20202) = 0
trigger1 = teamside = 1
anim = 20201+2*(root,var(25)>=2000)
id = 20202
sprpriority = 8
postype = left
pos = 24,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;スキル2球白
[State 20000]
type = Explod
triggerall = root,var(25) >= 2000
triggerall = numexplod(20202) = 0
trigger1 = teamside = 2
anim = 20201+2*(root,var(25)>=2000)
id = 20202
sprpriority = 8
postype = right
pos = -27,224+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.6,0.5

;-----------------------------------------------------------
[State 20000]
type = Explod
trigger1 = teamside = 1
anim = 20000
id = 20000
sprpriority = 9
postype = left
pos = 0,215+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.5,0.5

[State 20000]
type = Explod
trigger1 = teamside = 2
anim = 20005
id = 20005
sprpriority = 9
postype = right
pos = -103,215+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.5,0.5

[State 20000]
type = Explod
trigger1 = teamside = 1
anim = 20300+floor(power/1000)
id = 20300
sprpriority = 9
postype = left
pos = 12,227+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.5,0.5

[State 20000]
type = Explod
trigger1 = teamside = 2
anim = 20300+floor(power/1000)
id = 20300
sprpriority = 9
postype = right
pos = -14,227+root,var(27)
ontop = 1
bindtime = -1
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999
scale = 0.5,0.5



;-----------------------------------------------------------------------------
[Statedef -2]
;-----------------------------------------------------------------------------
;生存判定
[State -2]
type = Varset
trigger1 = alive
var(4) = 0
ignorehitpause = 1

[State -2]
type = Varset
trigger1 = !alive && var(4)!= 2
var(4) = 1
ignorehitpause = 1

[State -2]
type = Varset
trigger1 = !alive && var(4)= 1 && time=2
var(4) = 2
ignorehitpause = 1

;KOダメージボイス
[State -2,PlaySnd]
type = PlaySnd
trigger1 = roundstate = 3
trigger1 = !alive && var(4) = 1 && time = 1
value = 4,5
channel = 11
volume = 255

;----------------------------------------------
;特定技ヒット後ジャグル増大判定
[State -2, Combo]
type = VarSet
trigger1 = !numtarget
trigger1 = var(20) = 0
trigger2 = p2movetype != H
trigger2 = var(20) = 0
trigger3 = P2bodydist Y >= 0  || p2movetype = A
trigger3 = var(20) = 1
;trigger4 = NumTarget(270)
;trigger4 = stateno = 1300
var(12) = 0
ignorehitpause = 1

[State -2, Combo];通常技
type = VarSet
triggerall = p2statetype = A
triggerall = movehit
trigger1 = stateno = [200,690]
var(12) = 1
ignorehitpause = 1

[State -2, Combo];クロウバイツ
type = VarSet
triggerall = p2statetype = A
triggerall = movehit
trigger1 = stateno = 1100
trigger2 = stateno = 1110
trigger3 = stateno = 1120
trigger4 = stateno = 1125
trigger5 = stateno = 1130
trigger6 = stateno = 1200
trigger7 = stateno = 1205
var(12) = 2
ignorehitpause = 1

;----------------------------------------------
;スーパーキャンセル判定
[State -2, 5]
type = VarSet
trigger1 = stateno = 1020
trigger2 = MoveContact
trigger2 = (stateno = 1120) || (stateno = 1125)
var(14) = 1
ignorehitpause = 1

[State 1305, 1]
type = VarSet
trigger1 = ctrl 
trigger2 = movetype = H
trigger3 = P2MoveType != H
trigger3 = stateno != 1020
var(14) = 0
ignorehitpause = 1

;----------------------------------------------
;ドリームキャンセル判定
[State 1020, 2]
type = VarSet
trigger1 = MoveContact
trigger1 = (stateno = 3000) || (stateno = 3010)
trigger2 = (stateno = 3110) && (animelem <= 43)
var(15) = 1
ignorehitpause = 1

[State 1305, 1]
type = VarSet
trigger1 = ctrl
trigger2 = (stateno = 3110) && (animelem >= 44)
trigger3 = movetype = H
trigger4 = P2MoveType != H
var(15) = 0
ignorehitpause = 1

;----------------------------------------------
スーパーキャンセル,ドリームキャンセルコンボ制限解除
[State -2, Kill Juggle Checking]
type = assertspecial
trigger1 = var(14) = 1 || var(15) = 1
trigger1 = P2MoveType = H; && P2stateType = A
flag = nojugglecheck

;----------------------------------------------
;ファイナルキャノンタイムカウント
[state -2]
type = varset
trigger1 = stateno != 3210
var(18) = 0
ignorehitpause = 1

;----------------------------------------------
;ファイナルキャノンヒットタイムカウント
[state -2]
type = varadd
trigger1 = var(21) >= 1
trigger1 = 1
var(21) = -1
ignorehitpause = 1

;----------------------------------------------
[State 3000, Targetstate]
type = Targetstate
triggerall = projhit3250 = 1
trigger1 = Target,BackEdgeBodyDist > 20
trigger2 = Target,FrontEdgeBodyDist > 20
value = 3280

[State 3000, Targetstate]
type = Targetstate
triggerall = projhit3250 = 1
trigger1 = Target,BackEdgeBodyDist <= 20
trigger2 = Target,FrontEdgeBodyDist <= 20
value = 3282

;----------------------------------------------
;通常技ガード判定
[State 1020, 2]
type = VarSet
trigger1 = Stateno = [200,690]
trigger1 = P2Stateno = [120,155]
var(19) = 1
ignorehitpause = 1

[State 1020, 2]
type = VarSet
trigger1 = P2Stateno != [120,155]
var(19) = 0
ignorehitpause = 1

;----------------------------------------------
;空中ガードシステム
[State -2, 3]
type = null;VarSet
triggerall = NumProj
triggerall = roundstate = 2
triggerall = Var(12) = 1
trigger1 =  1
var(20)  = 0

[State 1000, 0]
type = AssertSpecial
triggerall = var(20)  = 1
triggerall = roundstate = 2
trigger1 =  1
flag = noairguard

[State 1000, 0]
type = AssertSpecial
triggerall = var(20)  = 1
triggerall = roundstate = 2
trigger1 =  1
trigger1 = p2statetype = A
flag = unguardable

;----------------------------------------------
;スキルゲージ
[state -2]
type = varadd
trigger1 = roundstate = 2
trigger1 = var(25) < 2000
trigger1 = ifelse(var(25)>1000,gametime%2,1)
var(25) = 1
ignorehitpause = 1

[state -2]
type = varset
trigger1 = 1
var(26) = ifelse(var(25)<1000,0,ifelse(var(25)>=2000,2,1))
ignorehitpause = 1

[state -2]
type = varset
trigger1 = roundstate = 0
var(25) = 0
ignorehitpause = 1

[state -2]
type = varset
trigger1 = var(28) = 1
var(25) = 2000
ignorehitpause = 1

;-----------------------------------------------------------------------
;ダメージ補正
[state -2]
type = varset
trigger1 = 1
trigger2 = RoundState = 0
trigger3 = P2MoveType != H
trigger4 = P2stateno = [120,155]
;trigger2 = enemy,gethitvar(hitcount) = 0
fvar(0) = 1.0

[state -2]
type = varset
trigger1 = P2MoveType = H
trigger1 = enemy,gethitvar(hitcount) >= 2
fvar(0) = abs((100.0-(25.0+(enemy,gethitvar(hitcount)/2.0)*5.0))/100.0)
IgnoreHitPause = 1

[state -2]
type = attackmulset
trigger1 = 1
value = fvar(0)

;--------------------------------------------------------
;ネバリ補正（根性値）
[State -2, DefenceMulSet]
type = DefenceMulSet
triggerall = ceil(1000*life/const(data.life)) > 750
triggerall = gethitvar(hitcount) > 0
trigger1 = numenemy
value = 1
ignorehitpause = 1

[State -2, DefenceMulSet]
type = DefenceMulSet
triggerall = ceil(1000*life/const(data.life)) = [151,750]
triggerall = gethitvar(hitcount) > 0
trigger1 = numenemy
value = 0.75
ignorehitpause = 1

[State -2, DefenceMulSet]
type = DefenceMulSet
triggerall = ceil(1000*life/const(data.life)) < 151
triggerall = gethitvar(hitcount) > 0
trigger1 = numenemy
value = 0.5
ignorehitpause = 1

;--------------------------------------------------------
;空中復帰誘導
[State -2, airReturn]
type = VarSet
trigger1 = !NumTarget
trigger2 = P2MoveType != H
trigger3 = movehit
trigger4 = projhit = 1
trigger5 = numtarget
trigger5 = !target,gethitvar(fall)
fvar(2) = 0
ignorehitpause = 1

[State -2, airReturn]
type = VarSet
triggerall = P2MoveType = H
triggerall = P2stateType = A
triggerall = movehit
triggerall = (stateno = [200,650])
trigger1 = stateno != 250
trigger1 = stateno != 255
trigger1 = stateno != 260
trigger1 = stateno != 265
trigger1 = stateno != 270
trigger1 = stateno != 280
trigger1 = stateno != 450
trigger1 = stateno != 650
fvar(2) = 1
ignorehitpause = 1

[State -2, airReturn]
type = TargetState
triggerall = Numtarget
triggerall = fvar(2)
trigger1 = target,stateno = 5050
trigger1 = target,alive
value = 950

;--------------------------------------------------------
;ゲージ
[state -2,Helper]
type = Helper
trigger1 = numhelper(20000) = 0
stateno = 20000
id = 20000
name = "Gauge"
sprpriority = 5
pos = 0,600
postype = back
helpertype = normal
keyctrl = 0 
ownpal = 1
IgnoreHitPause = 1
SuperMoveTime = 9999999999
PauseMoveTime = 9999999999

;--------------------------------------------------------
;config
[state -2,Helper]
type = Helper
;trigger1 = roundsexisted <= 0
trigger1 = roundstate = 0
stateno = 6000
id = 6000
name = "config"
pos = -300,0
postype = Left
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1
SuperMoveTime = 9999999999
PauseMoveTime = 9999999999

;----------------------------------------------
[State 2001, 2053]
type = removeExplod
triggerall = NumExplod(3150) > 0
trigger1 = MoveType = H
ID = 3150

;----------------------------------------------
;afterimage除去
[State -2, RemoveAfterImage]
type = AfterImageTime
trigger1 = MoveType = H
time = 0

[State -2, RemoveAfterImage]
type = null;AfterImageTime
trigger1 = stateno != 3100
trigger1 = stateno != 3110
trigger1 = stateno != 3130
trigger1 = stateno != 3400
trigger1 = stateno != 3400
trigger1 = stateno != 3401
trigger1 = stateno != 3402
time = 0

;----------------------------------------------
;AssertSpecial除去
[State -2, AssertSpecial]
type = null;AssertSpecial
triggerall = time = 0
trigger1 = stateno != 3100 && Prevstateno = 3100
flag = NoFG
flag2 = NOBG
flag3 = noshadow
ignorehitpause = 1

;----------------------------------------------
;端でめくらないように
[State -2, 100]
type = Width
trigger1 = p2Dist X >= 0
edge = 3,-3

[State -2, 100]
type = Width
trigger1 = p2Dist X < 0
edge = -3,3

;----------------------------------------------
;攻撃音止め
[State -2, 3]
type = stopSnd
trigger1 = MoveType = H
channel = 0

;ダッシュの音止め
[State -2, 1]
type = stopSnd
trigger1 = stateno != 100
channel = 1

;挑発の音止め
[State -2, 1]
type = stopSnd
trigger1 = stateno != 195
channel = 2

;イントロ音止め
[State -2, 3]
type = stopSnd
trigger1 = stateno != 191
trigger1 = stateno != 192
channel = 3

;----------------------------------------------
;バンカータイムカウント
[state -2]
type = varadd
trigger1 = stateno = 3020
trigger1 = 1
var(39) = 1
ignorehitpause = 1

[state -2]
type = varset
trigger1 = stateno = 200
var(39) = 0
ignorehitpause = 1

;----------------------------------------------
;ダメージボイス
;地上やられ
[State -2,PlaySnd]
type = PlaySnd
triggerall = Alive && Random%2 = 0
triggerall = Time = 1
triggerall = (StateNo = 5000 || StateNo = 5010 || StateNo = 5020)
trigger1 = GethitVar(animtype)=[0,2]
value = 4,ifelse((GethitVar(animtype)=[0,1]),0,1)
channel = 10
volume = 255

;地上吹き飛びやられ
[State -2,PlaySnd]
type = PlaySnd
triggerall = Alive && Random%2 = 0
triggerall = Time = 1
triggerall = (StateNo = 5000 || StateNo = 5010 || StateNo = 5020)
trigger1 = GethitVar(animtype)=[0,2]
value = 4,ifelse((GethitVar(animtype)=[4,5]),1,2)
channel = 10
volume = 255

;空中やられ
[State -2,PlaySnd]
type = null;PlaySnd
triggerall = Alive && Random%2 = 0
triggerall = Time = 1
triggerall = (StateNo = 5000 || StateNo = 5010 || StateNo = 5020)
trigger1 = GethitVar(animtype)=[0,2]
value = 4,ifelse((GethitVar(airtype)=[0,1]),2,3)
channel = 10
volume = 255

;空中吹き飛びやられ
[State -2,PlaySnd]
type = null;PlaySnd
triggerall = Alive && Random%2 = 0
triggerall = Time = 1
triggerall = (StateNo = 5000 || StateNo = 5010 || StateNo = 5020)
trigger1 = GethitVar(animtype)=[0,2]
value = 4,ifelse((GethitVar(airtype)=[4,5]),1,2)
channel = 10
volume = 255


;--------------------------------------------------------
;デバック用
[State -2]
Type = DisplayToClipBoard
Trigger1 = 1
Text = "(14)=%d,(15)=%d,(21)=%d,p2Vel X: %d ,\n"
Params = var(14),var(15),var(21),ceil(enemynear,Vel X)
IgnoreHitPause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999

[State -2,]
type = AppendToClipboard
trigger1 = 1
text = "P2BodyDist X: %d | P2BodyDist Y: %d | ScreenPos X: %d | Pos Y: %d \n"
params	= floor(P2BodyDist X),ceil(P2BodyDist Y),ceil(ScreenPos X),ceil(Pos Y)
ignorehitpause = 1
SuperMoveTime = 9999
PauseMoveTime = 9999


;---------------------------------------------------------------------------------
[Statedef -3];常時監視ステート(p2statenoなどで相手に行動を制御された時は実行しない)
;---------------------------------------------------------------------------------
;着地音
[State -3, 3]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 52
trigger2 = stateno = 107
trigger3 = stateno = 1320
value = 40,0
