
;###########################################################################
; 超必殺技，MAX超必殺技，MAX2
;###########################################################################

;===============================================================
; 双掌昇陽_弱
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3000]
type = S
movetype = A
physics = S
poweradd = -1000*!var(6)
ctrl = 0
anim = 3000
velset = 0, 0

[State 3000, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3000, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3000, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3000, VarSet]
type = VarSet
trigger1 = Time = 0
fvar(0) = 0

[State 3000, NotHitBy]
type = NotHitBy
trigger1 = AnimElemTime(4) < 0
value = SCA
time = 1
IgnoreHitPause = 1

[State 3000, Helper]
type = Helper
trigger1 = AnimElem = 2
id = 8500
name = "super"
pos = 12,-88	; 36
postype = P1
stateno = 8500
helpertype = normal
ownpal = 0
persistent = 0
pausemovetime = 99999999999999
supermovetime = 99999999999999

; スーパーポーズの判定
[State 3000, VarSet]
type = VarSet
trigger1 = AnimElem = 2
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3000, SuperPause]
type = SuperPause
trigger1 = AnimElem = 2
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

;ハア！
[State 3000, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 4
value = s12, 6
channel = 0

;オラァ！
[State 3000, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 9
value = s11, 1
channel = 0

;風切り音
[State 3000, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 10
value = s5, 0
channel = 1

[State 3000, PosAdd]
type = PosAdd
trigger1 = AnimElem = 7
trigger1 = P2Dist X > 37
X = 37

;砂埃
[State 3000 Explod]
type = explod
trigger1 = AnimElem = 10
postype = p1
pos = 45, 5
sprpriority = 6
anim = 7300
persistent = 1

[State 3000, HitDef]
type = HitDef
trigger1 = AnimElem = 4
attr = S, HA
animtype = Hard
damage = 140, 8
getpower = 0, 0
giverpower = 30, 30
hitflag = MAF
guardflag = M
pausetime = 46, 64 ;44,46
guard.pausetime = 44, 46 ;34, 36
sparkno = s8030
guard.sparkno = S8070
sparkxy = -20,-70
hitsound = s1, 4
guardsound = s2,1
ground.type = High
ground.slidetime = 18	; 20	; 24
ground.hittime  = 22	; 24	; 36
ground.velocity = -6
guard.velocity = -8
air.velocity = -5, -8	; -5, -10
air.hittime  = 3
envshake.time = 20
envshake.ampl = -3
envshake.freq = 100
envshake.phase = -3
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
id = IfElse(var(1)=0,3000,1);1+(var(1)=0)
nochainid = var(11)

[State 3000, HitDef]
type = HitDef
trigger1 = AnimElem = 12,= 0
trigger2 = AnimElem = 12,= 1
trigger3 = AnimElem = 12,= 2
trigger4 = AnimElem = 12,= 3
attr = S, HA
animtype = diagup
damage = 17, 8
getpower = 0,0
giverpower = 30, 30
guardflag = M
pausetime = 3, 3
sparkno = s8010
guard.sparkno = s8060
sparkxy = 0 - Random % 20, -50 - Random % 20	;-10, -70
spark.postype = p2
spark.sprpriority = 4
hitsound = s1, 4	;s1,4
guardsound = s2, 1
ground.type = High
ground.slidetime = 15
ground.hittime  = 30
ground.velocity = -4,-6
guard.velocity = -2
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
nochainid = var(11)

[State 3000, HitDef]
type = HitDef
trigger1 = AnimElem = 13,= 0
attr = S, HA
animtype = diagup
damage = 25, 8
getpower = 0, 0
givepower = 30, 30
guardflag = M
pausetime = 0, 8
sparkno = s8030
guard.sparkno = s8070
sparkxy = -10,-70
spark.postype = p2
;spark.sprpriority = 4
hitsound  = s1, 5	; s1, 4
guardsound = s2, 1
ground.type = High
ground.slidetime = 17
ground.hittime  = 21
ground.velocity = -5, -12
guard.velocity = -6
air.velocity = -5, -10
air.hittime  = 3
fall = 1
fall.recover = 0
yaccel = .55
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
id = IfElse(var(1)=0,3001,1);1+(var(1)=0)
nochainid = var(11)

[State 3000, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(14) = 0
movetype = I

[State 3000, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===============================================================
; 双掌昇陽_強
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3010]
type = S
movetype = A
physics = S
poweradd = -1000*!var(6)
ctrl = 0
anim = 3000
velset = 0, 0

[State 3010, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3010, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3010, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3010, VarSet]
type = VarSet
trigger1 = Time = 0
fvar(0) = 0

[State 3010, NotHitBy]
type = NotHitBy
trigger1 = AnimElemTime(5) < 0
value = SCA
time = 1
IgnoreHitPause = 1

[State 3010, Helper]
type = Helper
trigger1 = AnimElem = 2
id = 8500
name = "super"
pos = 12,-88
postype = P1
stateno = 8500
helpertype = normal
ownpal = 0
persistent = 0
pausemovetime = 99999999999999
supermovetime = 99999999999999

; スーパーポーズの判定
[State 3010, VarSet]
type = VarSet
trigger1 = AnimElem = 2
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3010, SuperPause]
type = SuperPause
trigger1 = AnimElem = 2
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

;ハア！
[State 3010, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 4
value = s12, 6
channel = 0

;オラァ！
[State 3010, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 9
value = s11, 1
channel = 0

;風切り音
[State 3010, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 10
value = s5, 0
channel = 1

[State 3010, PosAdd]
type = PosAdd
trigger1 = AnimElem = 7
trigger1 = P2Dist X > 37
X = 37

;砂埃
[State 3010, Explod]
type = explod
trigger1 = AnimElem = 10
postype = p1
pos = 45, 5
sprpriority = 6
anim = 7300
persistent = 1

[State 3010, HitDef]
type = HitDef
trigger1 = AnimElem = 4
attr = S, HA
animtype = Hard
damage = 140, 8
getpower = 0, 0
givepower = 30, 30
hitflag = MAF
guardflag = M
pausetime = 46, 64 ;44,46
guard.pausetime = 44, 46 ;34, 36
sparkno = s8030
guard.sparkno = s8070
sparkxy = -20,-70
hitsound = s1, 4
guardsound = s2,1
ground.type = High
ground.slidetime = 24
ground.hittime  = 36
ground.velocity = -6
guard.velocity = -8
air.velocity = -5, -8	; -5, -10
air.hittime  = 3
envshake.time = 20
envshake.ampl = -3
envshake.freq = 100
envshake.phase = -3
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
id = IfElse(var(1)=0,3010,1);1+(var(1)=0)
nochainid = var(11)

[State 3010, HitDef]
type = HitDef
trigger1 = AnimElem = 12,= 0
trigger2 = AnimElem = 12,= 1
trigger3 = AnimElem = 12,= 2
trigger4 = AnimElem = 12,= 3
attr = S, HA
animtype = diagup
damage = 17, 8
getpower = 0, 0
givepower = 30, 30
guardflag = M
pausetime = 3, 3
sparkno = s8010
guard.sparkno = s8060
sparkxy = 0 - Random % 20, -50 - Random % 20	;-10, -70
spark.postype = p2
spark.sprpriority = 4
hitsound = s1, 4	;s1,4
guardsound = s2, 1
ground.type = High
ground.slidetime = 15
ground.hittime  = 30
ground.velocity = -4,-6
guard.velocity = -2
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
nochainid = var(11)

[State 3010, HitDef]
type = HitDef
trigger1 = AnimElem = 13,= 0
attr = S, HA
animtype = diagup
damage = 25	;58, 0
getpower = 0, 0
givepower = 30, 30
guardflag = M
pausetime = 0, 8
sparkno = s8030
guard.sparkno = s8070
sparkxy = -10,-70
spark.postype = p2
;spark.sprpriority = 4
hitsound  = s1, 5	; s1, 4
guardsound = s2, 1
ground.type = High
ground.slidetime = 17
ground.hittime  = 21
ground.velocity = -5, -12
guard.velocity = -6
air.velocity = -5, -10
air.hittime  = 3
envshake.time = 20
envshake.ampl = -3
envshake.freq = 100
envshake.phase = -3
fall = 1
fall.recover = 0
yaccel = .55
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
id = IfElse(var(1)=0,3011,1);1+(var(1)=0)
nochainid = var(11)

[State 3010, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(14) = 0
movetype = I

[State 3010, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===============================================================
; 三巴昇陽
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------
[StateDef 3100]
type = S
movetype = A
physics = S
poweradd = ifelse(var(6), -1000, -3000)
ctrl = 0
anim = 3100
sprpriority = 0
velset = 0, 0

[State 3100, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3100, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3100, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3100, VarSet]
type = VarSet
trigger1 = Time = 0
fvar(0) = 0

[State 3100, NotHitBy]
type = NotHitBy
trigger1 = AnimElemTime(5) < 0
value = SCA
ignorehitpause = 1

[State 3100, Super]
type = Helper
trigger1 = AnimElem = 2
id = 8510
name = "super"
pos = 12,-88
postype = P1
stateno = 8500
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1
persistent = 0
supermovetime = 99999999999999
pausemovetime = 99999999999999

; スーパーポーズの判定
[State 3100, VarSet]
type = VarSet
trigger1 = AnimElem = 2
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3100, SuperPause]
type = SuperPause
trigger1 = AnimElem = 2
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

;ハァ！
[State 3100, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 4
value = s12, 6
channel = 0

[State 3100, NotHitBy]
type = NotHitBy
trigger1 = AnimElemTime(4) < 0
value = SCA
time = 1
IgnoreHitPause = 1

[State 2100, 5]
type = VelSet
trigger1 = AnimElem = 1
x = 0

;砂埃
[State 3100, Explod]
type = explod
trigger1 = AnimElem = 4
postype = p1
pos = 60, 5
sprpriority = 6
anim = 7200
persistent = 1

;オラァ！
[State 3100, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 10
value = s11, 1
channel = 0

;風切り音
[State 3100, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 11
value = s5, 0
channel = 1

;砂埃
[State 3100, Explod]
type = explod
trigger1 = AnimElem = 10
postype = p1
pos = 35, 5
sprpriority = 6
anim = 7200
persistent = 1

;砂埃
[State 3100, Explod]
type = explod
trigger1 = AnimElem = 11
postype = p1
pos = 45, 5
sprpriority = 6
anim = 7300
persistent = 1

;砂埃
[State 3100, Explod]
type = explod
trigger1 = AnimElem = 13
postype = p1
pos = 55, -10
sprpriority = 6
anim = 7300
persistent = 1

[State 3100, PosAdd]
type = PosAdd
trigger1 = AnimElem = 7
trigger1 = P2Dist X > 37
X = 37

[State 3100, HitDef]
type = HitDef
trigger1 = AnimElem = 4
attr = S, HA
animtype = Hard
damage = 140, 8
getpower = 0, 0
givepower = 30, 30
hitflag = MAF
guardflag = M
pausetime = 46, 64 ;44,46
guard.pausetime = 44, 46 ;34, 36
sparkno = s8030
guard.sparkno = s8070
sparkxy = -20 ,-70
hitsound = s1, 4
guardsound = s2,1
ground.type = High
ground.slidetime = 24
ground.hittime  = 36
ground.velocity = -6
guard.velocity = -8
air.velocity = -5, -8
air.hittime  = 3
envshake.time = 20
envshake.ampl = -3
envshake.freq = 100
envshake.phase = -3
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
air.fall = 1
fall.recover = 0
fall.recovertime = 999	; 38
yaccel = .55
id = IfElse(var(1)=0,3100,1);1+(var(1)=0)
;p2StateNo = 9900
nochainid = var(11)

[State 3100, HitDef]
type = HitDef
trigger1 = AnimElem = 10
attr = S, HA
animtype = hard
damage = 41, 8	; 58, 8 ;50,20
getpower = 0, 0
guardflag = M
pausetime = 36, 36
sparkno = s8030
guard.sparkno = s8070
sparkxy = 0,-80
hitsound = s1, 4
guardsound = s2, 1
ground.type = low
ground.slidetime = 15
ground.hittime  = 19
ground.velocity = -1.0
guard.velocity = -1
air.velocity = -4,-6
air.hittime  = 3
envshake.time = 20
envshake.ampl = -3
envshake.freq = 100
envshake.phase = -3
air.fall = 1
fall.recover = 1
fall.recovertime = 999	; 38
yaccel = .55
;id = IfElse(var(1)=0,3101,1);1+(var(1)=0)
;p2StateNo = 9900
nochainid = var(11)
kill = 0

[State 3100, HitDef]
type = HitDef
trigger1 = AnimElem = 13, 0
trigger2 = AnimElem = 13, 1
trigger3 = AnimElem = 13, 2
trigger4 = AnimElem = 13, 3
trigger5 = AnimElem = 13, 4
attr = S, HA
animtype = diagup
damage = 17, 8
getpower = 0,0
givepower = 30, 30
guardflag = M
pausetime = 3, 3
sparkno = s8010
guard.sparkno = s8060
sparkxy = 0 - Random % 20, -50 - Random % 20	;-10, -70
spark.postype = p2
spark.sprpriority = 4
hitsound = s1, 4
guardsound = s2, 1
ground.type = High
ground.slidetime = 15
ground.hittime  = 30
ground.velocity = -4,-6
guard.velocity = -2
air.velocity = -4,-6
air.hittime  = 30
air.fall = 1
fall.recover = 0
yaccel = .55
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
nochainid = var(11)
kill = 0

[State 3100, HitDef]
type = HitDef
trigger1 = AnimElem = 13, 6
attr = S, HA
animtype = diagup
damage = 58, 8	; 83, 8 ;30,5
getpower = 0, 0
givepower = 30, 30
guardflag = M
pausetime = 12, 12
sparkno = s8030
guard.sparkno = s8070
sparkxy = -10, -70
spark.postype = p2
spark.sprpriority = 4
hitsound = s1, 5
guardsound = s2, 1
ground.type = High
ground.slidetime = 28
ground.hittime  = 32
ground.velocity = -3.5, -15	; -3,
guard.velocity = -6
air.velocity = -3.5, -14	; -4
air.hittime  = 3
fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
id = 3102	; IfElse(var(1)=0,3102,1);1+(var(1)=0)
nochainid = var(11)

;いい面になったじゃあねえか
[State 3100, ChangeState]
type = ChangeState
trigger1 = AnimElemTime(15) = 0
trigger1 = NumTarget
trigger1 = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
trigger1 = Target,GetHitVar(chainid) = 3102
value = 3101
ctrl = 0

[State 3100, BgPalFx]
type = BgPalFx
trigger1 = MoveType = A	; Time = 0
time = 1	; 391	; 74
mul = 230, 230, 230
invertall = 1
ignorehitpause = 1

[State 3100, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(14) = 0
movetype = I

[State 3100, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 挑発
;---------------------------------------------------------

[StateDef 3101]
type = S
movetype = I
physics = S
ctrl = 0
anim = 3101
velset = 0, 0

;いい面になったじゃあねぇか
[State 3101, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 7
value = s11, 6
channel = 0

[State 3101, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===============================================================
; 入り身 灘月_弱
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3200]
type = C
movetype = A
physics = N
poweradd = -1000*!var(6)
velset = 0, 0
anim = 3200
ctrl = 0

[State 3200, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3200, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3200, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3200, VarSet]
type = VarSet
trigger1 = Time = 0
fvar(0) = 0

[State 3200, NotHitBy]
type = NotHitBy
trigger1 = Time >= 2
trigger1 = AnimElemTime(7) < 0
value = SCA
time = 1
IgnoreHitPause = 1

[State 3200, Helper]
type = Helper
trigger1 = Time = 3
id = 8500
name = "super"
pos = 27, -80	; 36,-88
postype = P1
stateno = 8500
helpertype = normal
ownpal = 0
persistent = 0
pausemovetime = 99999999999999
supermovetime = 99999999999999

; スーパーポーズの判定
[State 3200, VarSet]
type = VarSet
trigger1 = Time = 3
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3200, SuperPause]
type = SuperPause
trigger1 = Time = 3
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

[State 3200, Width]
type = Width
trigger1 = 0	;AnimElem = 8
value = 12

;貰った！
[State 3200, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 3
value = s11, 2
channel = 0

[State 3210, VelSet]
type = VelSet
trigger1 = AnimElemTime(3) >= 0
trigger1 = AnimElemTime(6) < 0
x = 2

[State 3200, VelSet]
type = VelSet
trigger1 = AnimElem = 6
x = 7

[State 3200, VelSet]
type = VelAdd
trigger1 = AnimElemTime(7) > 0
trigger1 = AnimElemTime(12) < 0
x = -0.4

[State 3200, VelSet]
type = VelSet
trigger1 = AnimElemTime(12) = 0
x = 0

[State 3200, Explod]
type = explod
trigger1 = AnimElem = 3
postype = p1
pos = -30, 0
sprpriority = 0
anim = 7400
persistent = 1
ownpal = 1

[State 3200, HitDef]
type = HitDef
trigger1 = AnimElem = 10
attr = C, HA
hitflag = M	; MAF
damage = 25, 8
getpower = 0, 0
givepower = 30, 30
animtype = Hard
guardflag = L
pausetime = 12, 12
hitsound = s1, 3
guardsound = s2, 1
sparkno = s8010
guard.sparkno = s8060
sparkxy = 0, -10
ground.type = low
ground.slidetime = 10
ground.hittime  = 14
ground.velocity = 0, 0
guard.velocity = -12
air.velocity = 0, 0
;P1StateNo = 3201
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
id = 3200	; IfElse(var(1)=0,3200,1);1+(var(1)=0)
nochainid = var(11)
kill = 0

[State 3200, TargetState]
type = null	; TargetState
triggerall = NumTarget(3200)
;triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
triggerall = AnimElemTime(10) >= 0 && AnimElemTime(11) <= 0
trigger1 = 1
value = 3202
id = 3200
persistent = 0
ignorehitpause = 1

[State 3200, ChangeState]
type = ChangeState
triggerall = NumTarget(3200)
triggerall = AnimElemTime(10) >= 0
;triggerall = HitPauseTime = 0
trigger1 = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
value = 3201
persistent = 0

[State 3200, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(11) = 0
movetype = I

[State 3200, ChangeState] 
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===============================================================
; 入り身 灘月_強
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3210]
type = C
movetype = A
physics = N
poweradd = -1000*!var(6)
velset = 0, 0
anim = 3210
ctrl = 0

[State 3210, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3210, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3210, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3210, VarSet]
type = VarSet
trigger1 = Time = 0
fvar(0) = 0

[State 3210, NotHitBy]
type = NotHitBy
trigger1 = Time >= 3
trigger1 = AnimElemTime(7) < 0
value = SCA
time = 1
IgnoreHitPause = 1

[State 3210, Helper]
type = Helper
trigger1 = Time = 4
id = 8500
name = "super"
pos = 27, -80	; 36,-88
postype = P1
stateno = 8500
helpertype = normal
ownpal = 0
persistent = 0
pausemovetime = 99999999999999
supermovetime = 99999999999999

; スーパーポーズの判定
[State 3210, VarSet]
type = VarSet
trigger1 = Time = 4
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3210, SuperPause]
type = SuperPause
trigger1 = Time = 4
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

;貰った！
[State 3210, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 4
value = s11, 2
channel = 0

[State 3210, VelSet]
type = VelSet
trigger1 = AnimElemTime(3) >= 0
trigger1 = AnimElemTime(6) < 0
x = 2

[State 3210, VelSet]
type = VelSet	;VelAdd
trigger1 = AnimElem = 6
x = 7	 ; 5

[State 3210, VelSet]
type = VelAdd
trigger1 = AnimElemTime(7) > 0
trigger1 = AnimElemTime(12) < 0
x = -0.4

[State 3100, VelSet]
type = VelSet
trigger1 = AnimElemTime(12) = 0
x = 0

[State 3210, Explod]
type = explod
trigger1 = AnimElem = 3
postype = p1
pos = -30, 0
sprpriority = 0
anim = 7400
persistent = 1
ownpal = 1

[State 3210, HitDef]
type = HitDef
trigger1 = AnimElem = 10
attr = C, HA
hitflag = M	; MAF
damage = 25, 8
getpower = 0, 0
givepower = 30, 30
animtype = Hard
guardflag = L
pausetime = 12, 12
hitsound = s1, 3
guardsound = s2, 1
sparkno = s8010
guard.sparkno = s8060
sparkxy = 0, -10
ground.type = Low
ground.slidetime = 10
ground.hittime  = 14
ground.velocity = 0, 0
guard.velocity = -12
air.velocity = 0,0
;P1StateNo = 3201
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .55
id = 3210	; IfElse(var(1)=0,3210,1);1+(var(1)=0)
nochainid = var(11)
kill = 0

[State 3210, TargetState]
type = null	; TargetState
triggerall = NumTarget(3210)
triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
triggerall = AnimElemTime(10) >= 0 && AnimElemTime(11) <= 0
trigger1 = 1
value = 3202
id = 3210
persistent = 0
ignorehitpause = 1

[State 3210, ChangeState]
type = ChangeState
triggerall = NumTarget(3210)
triggerall = AnimElemTime(10) >= 0
;triggerall = HitPauseTime = 0
trigger1 = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
value = 3201
persistent = 0

[State 3210, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(11) = 0
movetype = I

[State 3210, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 追撃
;---------------------------------------------------------

[StateDef 3201]
type =  C
movetype = A
physics = C
poweradd = 0
velset = 0, 0
anim = 3201
ctrl = 0

[State 3201, TargetBind]
type = TargetBind
trigger1 = Time = 0
pos = 45, 0	; 50, 0

;オラァ！
[State 3201, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 9
trigger2 = AnimElem = 21
trigger3 = AnimElem = 28
value = s11, 3
channel = 0

;オラァー！
[State 3201, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 33
value = s8, 4
channel = 0

[State 3201, HitDef]
type = HitDef
trigger1 = AnimElem = 4
trigger2 = AnimElem = 10
trigger3 = AnimElem = 16
trigger4 = AnimElem = 22
attr = C, HA
hitflag = MAF+
damage = 25, 8 ;25,5
getpower = 0, 0
animtype = Hard
guardflag = L
pausetime = 12, 12
hitsound = S1, 4
guardsound = S2, 1
sparkno = s8020
guard.sparkno = s8070
sparkxy = -30, -50
ground.type = high
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = 0,0
air.velocity = 0,0
kill = 0

[State 3201, HitDef]
type = HitDef
trigger1 = AnimElem = 28
attr = C, HA
hitflag = MAF+
damage = 25, 8 ;30,5
getpower = 0, 0
givepower = 30, 30
animtype = Hard
guardflag = L
pausetime = 48, 48
hitsound = S1, 4
guardsound = S2, 1
sparkno = s8020
guard.sparkno = s8070
sparkxy = -30, -50
ground.type = Low
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = 0,0
air.velocity = 0,0
envshake.time = 25
envshake.ampl = -5
envshake.freq = 90
envshake.phase = -3
kill = 0

[State 3201, HitDef]
type = HitDef
trigger1 = AnimElem = 33
attr = C, HA
hitflag = MAF+
damage = 25, 8 ;50,10
getpower = 0, 0
givepower = 30, 30
animtype = up
guardflag = L
pausetime = 48, 48
hitsound = S1, 5
guardsound = S2, 1
sparkno = s8030
guard.sparkno = s8070
sparkxy = -30,-50
ground.type = Low
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = -0, -12.5
air.velocity = -0, -12.0
guard.velocity = -12
ground.cornerpush.veloff = 0
envshake.time = 30
envshake.ampl = -4
envshake.freq = 90
envshake.phase = -3
fall = 1
fall.recover = 0
yaccel = .55
id = 3201
;p2stateno = 3151

;花鳥乱月
[State 3201, ChangeState]
type = ChangeState
triggerall = Var(59) = 0
triggerall = Helper(8990),var(0) = 3600
triggerall = power >= 1000
triggerall = NumTarget
triggerall = Target,MoveType = H && Target,StateNo = [5000, 5199]
trigger1 = AnimelemTime(29) = 0
value = 3600

[State 3201, BGPalFx]
type = BGPalFX
triggerall = MoveHit = 1
triggerall = !NumHelper(10000)
trigger1 = AnimElemTime(4) = 1 || AnimElemTime(10) = 1 || AnimElemTime(16) = 1 || AnimElemTime(22) = 1
trigger1 = HitPauseTime = 11
trigger2 = AnimElemTime(28) = 1 || AnimElemTime(33) = 1
trigger2 = HitPauseTime = 44
time = 1
add = 200, 200, 200
ignorehitpause = 1
invertall = 1

[State 3201, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(34) = 0
movetype = I

[State 3201]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 相手
;---------------------------------------------------------

[StateDef 3202]
type = S
movetype = H
physics = S
velset = 0, 0

[State 3202, ChangeAnim2]
type = ChangeAnim2
trigger1 = Time = 0
value = 3202

[State 3202, HitBy]
type = HitBy
trigger1 = 1
value = C, HA
time = 1
ignorehitpause = 1

[State 3202, SelfState]
type = SelfState
trigger1 = Time > 30
value = 5210
ctrl = 0

;===============================================================
; 花鳥乱月
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3600]
type = C
movetype = A
physics = C
poweradd = ifelse(var(6), -1000, -3000)
ctrl = 0
anim = 3600
velset = 0, 0

; 先行入力発動時の振り向き
[State 3600, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

[State 3600, Helper]
type = Helper
trigger1 = AnimElemTime(1) = 0
stateno = 8600
pausemovetime = 99999999999999
supermovetime = 99999999999999
ownpal = 1
persistent = 0

[State 3600, Helper]
type = Helper
trigger1 = AnimElemTime(1) = 0
id = 8520
pos = -20, -35
postype = P1
stateno = 8500
helpertype = normal
ownpal = 1
bindtime = -1
persistent = 0
pausemovetime = 99999999999999
supermovetime = 99999999999999

; スーパーポーズの判定
[State 3600, VarSet]
type = VarSet
trigger1 = AnimElemTime(1) = 0
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3600, SuperPause]
type = SuperPause
trigger1 = AnimElemTime(1) = 0
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

[State 3600, NotHitBy]
type = NotHitBy
trigger1 = 1	; AnimElemTime(2) < 0 ;Time = 0
value = SCA
time = 1
IgnoreHitPause = 1

;まだまだぁ！
[State 3600, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 1
value = s5200, 0
channel = 0

;へァー！
[State 3600, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 5
value = s8, 6	; s8, 4
channel = 0

;オルァー！
[State 3600, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 45
value = s11, 1	; s11,5
channel = 0

;とどめだ！
[State 3600, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 55
value = s183, 0
channel = 0

;オラー↑！
[State 3600, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 64
value = s8, 4
channel = 0

;コークスクリュー
[State 3600, Explod]
type = explod
trigger1 = AnimElem = 65
postype = p1
anim = 7450
pos = 50, -78
sprpriority = 2	; 6
supermove = -1
supermovetime = 99999
persistent = 1
scale = 1,2

;砂埃
[State 3600, Explod]
type = explod
trigger1 = AnimElem = 56
postype = p1
pos = 60, 5
sprpriority = 2	; 6
anim = 7200
persistent = 1

[State 3600, AfterImage]
type = null	; AfterImage
trigger1 = Time = 1
time = 219
palmul = 1, 1, 1
paladd = 0, 0, 0
PalBright = 0, 0, 0
PalContrast = 60,60,60
length = 8
framegap = 3
trans = add1

[State 3600, AfterImage]
type = AfterImage
trigger1 = Time = 1
time = 219
length = 7
framegap = 2
palbright = 0,0,0
palcontrast = 90, 80, 200	; 128,128,128
paladd = 0,0,0
palmul = 1,1,1
trans = add1

[State 3600, TargetBind]
type = TargetBind
trigger1 = AnimElemTime(46) < 0
pos = 45, 0	; 50, 0

[State 3600, TargetBind]
type = TargetBind
trigger1 = AnimElem = 64
pos = 55, -30	; 60

[State 3600, HitDef]
type = HitDef
trigger1 = AnimElem = 4
trigger2 = AnimElem = 10
trigger3 = AnimElem = 16
trigger4 = AnimElem = 22
trigger5 = AnimElem = 28
trigger6 = AnimElem = 34
attr = C, HA
hitflag = MAF+
damage = 17	; 33
getpower = 0, 0
givepower = 30, 30
animtype = Hard
pausetime = 12, 5
hitsound = s1, 4
guardsound = S2, 1
sparkno = s8020
guard.sparkno = s8070
sparkxy = -30, -50
ground.type = Low
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = 0,0
air.velocity = 0,0
kill = 0

[State 3600, HitDef]
type = HitDef
trigger1 = AnimElem = 40
attr = C, HA
hitflag = MAF+
damage = 17
getpower = 0, 0
givepower = 30, 30
animtype = Hard
pausetime = 12, 12
hitsound = S1,4
guardsound = S2,1
sparkno = s8020
guard.sparkno = s8060
sparkxy = -30, -50
ground.type = Low
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = 0,0
air.velocity = 0,0
kill = 0
p2facing = 1

[State 3600, HitDef]
type = HitDef
trigger1 = AnimElem = 45
attr = C, HA
hitflag = MAF+
damage = 17
getpower = 0, 0
givepower = 30, 30
animtype = up
pausetime = 24, 24
hitsound = S1,5
guardsound = S2,1
sparkno = s8020
guard.sparkno = S8070
sparkxy = -30, -50
ground.type = Low
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = -0.2,-10.5
air.velocity = 0, 0
envshake.time = 30
envshake.ampl = -4
envshake.freq = 90
envshake.phase = -3
fall =1
fall.recover = 0
yaccel = .5
kill = 0

[State 3600, HitDef]
type = HitDef
trigger1 = AnimElem = 56
attr = S, HA
hitflag = MAF
damage = 58
getpower = 0, 0
givepower = 30, 30
animtype = up
pausetime = 36, 36
hitsound = S1,4
guardsound = S2,1
sparkno = s8020
guard.sparkno = s8070
sparkxy = -20, -80
ground.type = high
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = -0.5, -9.3	; -0.2,-9.3
air.velocity = -0.5, -9.3		; -0.5,-9.3
fall =1
fall.recover = 0
yaccel = .48
kill = 0
envshake.time = 30
envshake.ampl = -4
envshake.freq = 90
envshake.phase = -3

[State 3600, HitDef]
type = HitDef
trigger1 = AnimElem = 65
attr = S, HA
hitflag = MAF
damage = 58	;83, 8
getpower = 0, 0
givepower = 30, 30
animtype = diagup
pausetime = 24, 24
hitsound = s13, 4	; S1,5
guardsound = s2, 1
sparkno = s8030
guard.sparkno = s8070
sparkxy = -30, -70
ground.type = High
ground.slidetime = 30
ground.hittime  = 34
ground.velocity = -10, -3
air.velocity = -10, -2
yaccel = .5
;p2stateno = 3165
id = 3601
fall = 0
fall.recover = 0
ground.cornerpush.veloff = -20	;0
air.cornerpush.veloff = -20	; 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
envshake.time = 30
envshake.ampl = -4
envshake.freq = 120	; 90
envshake.phase = -3

[State 3600, TargetState]
type = TargetState
triggerall = NumTarget(3601)
triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
triggerall = AnimElemTime(65) >= 0 && AnimElemTime(66) < 0
;trigger1 = Target,StateType = A
trigger1 = Target, HitShakeOver = 1
value = 3602
id = 3601
persistent = 0
ignorehitpause = 1

[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 62
X = 9
[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 63
X = -3
[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 64
X = 9
[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 65
X = 7
[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 67
X = 9
[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 68
X = -3
[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 69
X = 2
[State 3600, PosAdd]
type = PosAdd
trigger1 = AnimElem = 70
X = 0

[State 3600, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(66) = 0
movetype = I

[State 3600, ScreenBound]
type = null	; ScreenBound
trigger1 = AnimElemTime(66) < 0
movecamera = 1, 0
ignorehitpause = 1

[State 3600, ScreenBound]
type = ScreenBound
trigger1 = AnimElemTime(66) >= 0
movecamera = 0, 0
ignorehitpause = 1

[State 3600, VarSet]
type = VarSet
trigger1 = var(2) != 2
trigger1 = time = 0
var(2) = 1

[State 3600, VarSet]
type = VarSet
trigger1 = var(3) != 2
trigger1 = time = 0
var(3) = 1

[State 3600, ChangeState]
type = ChangeState
trigger1 = NumTarget(3601)
trigger1 = Target,StateNo = 9911 && Target,Time = 1	; 9912
trigger1 = BackEdgeDist <= 0
value = 3601
ctrl = 0

[State 3600, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 移動
;---------------------------------------------------------
[Statedef 3601]
type = A
movetype = I
physics = N
anim = 3601
velset = 0, 0
poweradd = 0
ctrl = 0

[State 3601, ScreenBound]
type = ScreenBound
trigger1 = AnimElemTime(6) < 0
movecamera = 0, 0
ignorehitpause = 1

[State 3601, PosSet]
type = BindToTarget
trigger1 = AnimElemTime(6) = 0
time = 1
pos = 180, 0, foot

[State 3601, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 相手1
;---------------------------------------------------------
[Statedef 3602]
type = A
movetype = H
physics = N
anim = 5030
velset = 0,0
poweradd = 0
ctrl = 0

; 相手がガードまたはヘルパーの場合に相手を元のステートに戻す処理
[State 3602, SelfState]
type = SelfState
trigger1 = GetHitVar(Guarded)
trigger2 = IsHelper
value = PrevStateNo

[State 3602, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 3602, Turn]
type = Turn
trigger1 = Time = 0
trigger1 = P2Dist X < 0

[State 3602, VelSet]
type = VelSet
trigger1 = HitShakeOver
x = -10	;-6
y = -2	;-5
persistent = 0

[State 3602, ChangeState]
type = ChangeState
trigger1 = HitShakeOver
value = 3603

;---------------------------------------------------------
; 相手2
;---------------------------------------------------------
[Statedef 3603]
type    = A
movetype= H
physics = N
sprpriority = 1

; 相手がヘルパーの場合に相手を元のステートに戻す処理
[State 3603, SelfState]
type = SelfState
trigger1 = IsHelper
value = PrevStateNo

[State 3603, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 3603, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 3603, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0
value = 5030

[State 3603, ChangeAnim]
type = ChangeAnim
trigger1 = Time = 9	; 5
value = 5050

[State 3603, VelAdd]
type = VelAdd
Trigger1 = time != 0
y = .40	; 55

[State 3603, EnvShake]
type = EnvShake
trigger1 = Time = 0
time = 20
ampl = -4
freq = 60	; 90
phase = -3

[State 3603, ChangeState]
type = ChangeState
triggerall = Vel Y > 0
trigger1 = Pos Y >= 0	; 0
trigger1 = PrevStateNo = 3604
value = 9910

[State 3603, ChangeState]
type = ChangeState
triggerall = Vel Y > 0
trigger1 = Pos Y >= 30	; 0
value = 3604

;---------------------------------------------------------
; 相手3
;---------------------------------------------------------
[Statedef 3604]
type = A
movetype = H
physics = N
anim = 5030
velset = 0, 0
poweradd = 0
ctrl = 0

; 相手がガードまたはヘルパーの場合に相手を元のステートに戻す処理
[State 3604, SelfState]
type = SelfState
trigger1 = GetHitVar(Guarded)
trigger2 = IsHelper
value = PrevStateNo

[State 3604, PosSet]
type = Posset
trigger1 = Time = 0
y = 0

[State 3604, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 3604, Turn]
type = Turn
trigger1 = Time = 0
trigger1 = P2Dist X < 0

[State 3604, VelSet]
type = VelSet
trigger1 = Time = 4
x = -6	;-6
y = -4	;-5
persistent = 0

[State 3604, ChangeState]
type = ChangeState
trigger1 = Time = 4
value = 3603

;---------------------------------------------------------------------------
;壁面まで吹っ飛び
[StateDef 3165]
type = S
movetype = H
physics = S
ctrl = 0
velset = 0, 0

[State 3165, 1]
type = Changeanim
trigger1 = 0	; Time = 0 && SelfAnimExist(5900)
value = 5900

[State 3165, 2]
type = Changeanim2
trigger1 = Anim != 5900 && Time = 0
value = 5050	; 207

[State 3165, 3]
type = PosAdd
trigger1 = time > 30
;trigger1 = backedgebodydist > 10
x = -16
y = -2

[State 3165, ScreenBound]
type = ScreenBound
trigger1 = 1
movecamera = 1,0
ignorehitpause = 1

[State 3165, 5]
type = ChangeState
triggerall = Time >= 20
trigger1 = BackEdgeBodyDist <= -1
trigger2 = FrontEdgeBodyDist <= -1
trigger3 = Time = 200
value = 3170
ctrl = 0

;---------------------------------------
;壁面に激突
[StateDef 3170]
type = S
movetype = H
physics = N

[State 3170, 1]
type = PlaySnd
trigger1 = Time = 0
value = F5,4

[State 3170, 1]
type = ChangeAnim2
trigger1 = Time = 0
value = 3170

[State 3170, 1]
type = EnvShake
trigger1 = Time = 1
Time = 14
ampl = 12
freq = 80

[State 3170, ScreenBound]
type = ScreenBound
trigger1 = 1
movecamera = 1,0
ignorehitpause = 1

[State 3170, 2]
type = ChangeState
trigger1 = Time = 10
value = 3175

;---------------------------------------
;落下
[StateDef 3175]
type =  A
movetype = H
physics = N

[State 3175,1]
type = VelSet
trigger1 = Time = 0
y = -12

[State 3175,2]
type = VelSet
trigger1 = Time = 0
x = 2

[State 3175,3]
type = VelAdd
trigger1 = Time >= 0
y = .65

[State 3175,4]
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 3175,5]
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 3175,6]
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 3175,7]
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 3175,8]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;===============================================================
; 胴取り七悶殺
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3300]
type = S
movetype = A
physics = S
poweradd = -1000*!var(6)
anim = 3400
velset = 0, 0
ctrl = 0

[State 3300, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3300, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3300, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3300, VarSet]
type = VarSet
trigger1 = Time = 0
fvar(0) = 0

[State 3300, NotHitBy]
type = NotHitBy
trigger1 = AnimElemTime(6) < 0
value = , AA, AP
time = 1
ignorehitpause = 1

[State 3300, ReversalDef]
type = ReversalDef
trigger1 = AnimElem = 1
getpower = 0, 0
givepower = 0, 0
reversal.attr = SCA, NA, SA, HA
numhits = 0
pausetime = 12, 12
sparkno = s8060
sparkxy = 65, -50
;P1StateNo = 3301
;P2StateNo = 3302
p1facing = 1
p2facing = 1
hitsound = s810, 0	; s2, 0
id = 3300

[State 3300, TargetState]
type = TargetState
triggerall = NumTarget(3300)
triggerall = AnimElemTime(1) >= 0 && AnimElemTime(6) < 0
trigger1 = 1
value = 3302
id = 3300
persistent = 0
ignorehitpause = 1

[State 3300, ChangeState]
type = ChangeState
triggerall = NumTarget(3300)
triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
triggerall = Target,StateNo = 3302
trigger1 = AnimElemTime(1) >= 0 && AnimElemTime(6) < 0
value = 3301
ctrl = 0
persistent = 0
ignorehitpause = 1

[State 3300, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(6) = 0
movetype = I

[State 3300, ChangeState]
type = ChangeState
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 成功
;---------------------------------------------------------

[StateDef 3301]
type = S
movetype = A
physics = N
anim = 3301
poweradd = 0

[State 3301, Helper]
type = Helper
trigger1 = Time = 2
id = 8500
name = "super"
pos = 40, -84
postype = P1
stateno = 8500
helpertype = normal
ownpal = 0
persistent = 0
pausemovetime = 99999999999999
supermovetime = 99999999999999

; スーパーポーズの判定
[State 3301, VarSet]
type = VarSet
trigger1 = Time = 2
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3210, SuperPause]
type = SuperPause
trigger1 = Time = 2
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

;画面端裏周り対策
[State 3301, PosAdd]
type = PosAdd
trigger1 = Time = 0
x = 10

;掴み
[State 3301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 2
value = s800, 0

;叩きつけ
[State 3301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 10
value = s5, 4

;オイ！
[State 3301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 23
trigger2 = AnimElem = 33
trigger3 = AnimElem = 43
trigger4 = AnimElem = 53
trigger5 = AnimElem = 63
value = s11, 4
channel = 0

;オルァー！
[State 3301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 69
value = s11, 5
channel = 0

;ベキ
[State 3301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 23
trigger2 = AnimElem = 33
trigger3 = AnimElem = 43
trigger4 = AnimElem = 53
value = s1,2

;ドガーン
[State 3301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 63
value = s1,4

;巴投げの音
[State 3301, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 69
value = s811, 0

[State 3301, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 10
value = -ceil(Const(data.attack) * 0.01 * 41 * fVar(1))	; 33
kill = 0

[State 3301, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 23
trigger2 = AnimElem = 33
trigger3 = AnimElem = 43
trigger4 = AnimElem = 53
value = -ceil(Const(data.attack) * 0.01 * 41 * fVar(1))	; 33
kill = 0

[State 3301, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 63
value = -ceil(Const(data.attack) * 0.01 * 74 * fVar(1))	; 74
kill = 0

[State 3301, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 69
value = -ceil(Const(data.attack) * 0.01 * 74 * fVar(1))	; 74
kill = 1

[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 1
pos = 60, 0
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 2
pos = 55, 0
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 3
pos = 30, -15
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 4
pos = 42, -85
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 5
pos = 30, -90
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 6
pos = 25, -85
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 7
pos = -10, -90
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 8
pos = -20, -65
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 9
pos = -25, -50
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 10
pos = -25, 5
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 11
pos = 20, 0
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 66
pos = 33, -22
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 67
pos = 25, -65
[State 3301, TargetBind]
type = TargetBind
trigger1 = AnimElem = 68
pos = -25, -70

[State 3301, TargetState]
type = TargetState
trigger1 = AnimElem = 69
value = 3403

[State 3301, SprPriority]
type = SprPriority
trigger1 = AnimElem = 7
value = -3

[State 3301, SprPriority]
type = SprPriority
trigger1 = AnimElem = 10
value = 0

[State 3301, EnvShake]
type = EnvShake
trigger1 = AnimElem = 10
Time = 15
ampl = 6
freq = 90
phase = 5

[State 3301, EnvShake]
type = EnvShake
trigger1 = AnimElem = 63
Time = 20
ampl = 7
freq = 90
phase = 5

[State 3301, Explod]
type = explod
trigger1 = AnimElem = 2
postype = p1
pos = 60, -78
sprpriority = 1
anim = 8110
persistent = 1

[State 3301, Explod]
type = explod
trigger1 = AnimElem = 10
postype = p2
pos = 0, 5
sprpriority = -1
anim = 8200
persistent = 1

[State 3250,15]
type = explod
trigger1 = AnimElem = 10
postype = p2
pos = 0, 5
sprpriority = 6
anim = 8210
persistent = 1

[State 3301, Explod]
type = explod
triggerall = Time > 10
trigger1 = AnimElemTime(23) = 0
trigger2 = AnimElemTime(33) = 0
trigger3 = AnimElemTime(43) = 0
trigger4 = AnimElemTime(53) = 0
trigger5 = AnimElemTime(63) = 0
postype = p2
pos = -25, -5
bindtime = 1
sprpriority = 1
anim = 8020
ownpal = 1
ignorehitpause = 1

[State 3301, Explod]
type = explod
trigger1 = AnimElemTime(63) = 0
postype = p2
pos = -30, 5
sprpriority = -1
anim = 8200
persistent = 1

[State 3301, Explod]
type = explod
trigger1 = AnimElemTime(63) = 0
postype = p2
pos = -30, 5
sprpriority = 2
anim = 8210
persistent = 1

[State 3301, EnvColor]
type = EnvColor 
trigger1 = AnimElem = 10
trigger2 = AnimElem = 23
trigger3 = AnimElem = 33
trigger4 = AnimElem = 43
trigger5 = AnimElem = 53
time = 1
value = 255,255,255
under = 1
ignorehitpause = 0

[State 3301, AttackDist]
type = AttackDist
trigger1 = Time = 0
value = 0

[State 3301, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(70) = 0
movetype = I

[State 3301, PlayerPush]
type = PlayerPush
trigger1 = AnimElemTime(69) >= 0
value = 0
ignorehitpause = 1

[State 3301, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 相手1
;---------------------------------------------------------

[StateDef 3302]
type = L
movetype = H
physics = N
velset = 0, 0
ctrl = 0

[State 3302, SprPriority]
type = SprPriority
trigger1 = AnimElem = 5,< 0
value = -2

[State 3302, ChangeAnim2]
type = ChangeAnim2
trigger1 = Time = 0
value = 3302

[State 3302, ScreenBound]
type = ScreenBound
trigger1 = 1
movecamera = 1, 0
ignorehitpause = 1

[State 3302, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 3302, SelfState]
type = SelfState
trigger1 = AnimTime = 0
value = 5210
ctrl = 0

;===============================================================
; 胴取り七悶殺MAX
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3400]
type = S
movetype = A
physics = S
poweradd = ifelse(var(6), -1000, -3000)
anim = 3400
velset = 0, 0
ctrl = 0

[State 3400, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3400, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3400, Turn]
type = Turn
triggerall = Time = 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3400, VarSet]
type = VarSet
trigger1 = Time = 0
fvar(0) = 0

[State 3400, NotHitBy]
type = NotHitBy
trigger1 = AnimElemTime(6) < 0
value = , AA, AP
time = 1
ignorehitpause = 1

[State 3400, ReversalDef]
type = ReversalDef
trigger1 = 1
getpower = 0, 0
givepower = 0, 0
reversal.attr = SCA, NA, SA, HA
numhits = 0
pausetime = 12, 12
sparkno = s8060
sparkxy = 65, -50
p1facing = 1
p2facing = 1
hitsound = s810, 0	; s2, 0
id = 3400

[State 3400, TargetState]
type = TargetState
triggerall = NumTarget(3400)
;triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
triggerall = AnimElemTime(1) >= 0 && AnimElemTime(6) < 0
trigger1 = 1
value = 3402
id = 3400
persistent = 0
ignorehitpause = 1

[State 3400, ChangeState]
type = ChangeState
triggerall = NumTarget(3400)
triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
triggerall = Target,StateNo = 3402
trigger1 = AnimElemTime(1) >= 0 && AnimElemTime(6) < 0
value = 3401
ctrl = 0
persistent = 0
ignorehitpause = 1

[State 3400, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(6) = 0
movetype = I

[State 3400, ChangeState]
type = ChangeState
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 成功
;---------------------------------------------------------

[StateDef 3401]
type = S
movetype = A
physics = N
anim = 3401
poweradd = 0

[State 3401, Super]
type = Helper
trigger1 = Time = 1
id = 8510
name = "super"
pos = 40, -84	; 12, -88
postype = P1
stateno = 8500
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1
persistent = 0
supermovetime = 99999999999999
pausemovetime = 99999999999999

; スーパーポーズの判定
[State 3401, VarSet]
type = VarSet
trigger1 = Time = 1
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3401, SuperPause]
type = SuperPause
trigger1 = Time = 1
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

;画面端裏周り対策
[State 3301, PosAdd]
type = PosAdd
trigger1 = Time = 0
x = 10

;掴み
[State 3401, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 2
value = s800, 0

;叩きつけ
[State 3401, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 10
value = s5, 4

;オイ！
[State 3401, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 23
trigger2 = AnimElem = 33
trigger3 = AnimElem = 43
trigger4 = AnimElem = 53
trigger5 = AnimElem = 63
trigger6 = AnimElem = 73
trigger7 = AnimElem = 83
trigger8 = AnimElem = 93
value = s11, 4
channel = 0

;オルァー！
[State 3401, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 99
value = s11, 5
channel = 0

;ベキ
[State 3401, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 23
trigger2 = AnimElem = 33
trigger3 = AnimElem = 43
trigger4 = AnimElem = 53
trigger5 = AnimElem = 63
trigger6 = AnimElem = 73
trigger7 = AnimElem = 83
value = s1,2

;ドガーン
[State 3401, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 93
value = s1,4

;巴投げの音
[State 3401, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 99
value = s811, 0

[State 3401, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 10
value = -ceil(Const(data.attack) * 0.01 * 50 * fVar(1))
kill = 0

[State 3401, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 23
trigger2 = AnimElem = 33
trigger3 = AnimElem = 43
trigger4 = AnimElem = 53
trigger5 = AnimElem = 63
trigger6 = AnimElem = 73
trigger7 = AnimElem = 83
value = -ceil(Const(data.attack) * 0.01 * 50 * fVar(1))
kill = 0

[State 3401, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 93
value = -ceil(Const(data.attack) * 0.01 * 74 * fVar(1))	; 74
kill = 0

[State 3401, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = AnimElem = 99
value = -ceil(Const(data.attack) * 0.01 * 74 * fVar(1))	; 74
kill = 1

[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 1
pos = 60, 0
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 2
pos = 55, 0
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 3
pos = 30, -15
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 4
pos = 42, -85
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 5
pos = 30, -90
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 6
pos = 25, -85
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 7
pos = -10, -90
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 8
pos = -20, -65
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 9
pos = -25, -50
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 10
pos = -25, 5
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 11
pos = 20, 0
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 96
pos = 33, -22
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 97
pos = 25, -65
[State 3401, TargetBind]
type = TargetBind
trigger1 = AnimElem = 98
pos = -25, -70

[State 3401, TargetState]
type = TargetState
trigger1 = AnimElem = 99
value = 3403

[State 3401, SprPriority]
type = SprPriority
trigger1 = AnimElem = 7
value = -3

[State 3401, SprPriority]
type = SprPriority
trigger1 = AnimElem = 10
value = 0

[State 3401, EnvShake]
type = EnvShake
trigger1 = AnimElem = 10
Time = 15
ampl = 6
freq = 90
phase = 5

[State 3401, EnvShake]
type = EnvShake
trigger1 = AnimElem = 93
Time = 20
ampl = 7
freq = 90
phase = 5

[State 3401, Explod]
type = explod
trigger1 = AnimElem = 2
postype = p1
pos = 60, -78
sprpriority = 1
anim = 8110
persistent = 1

[State 3401, Explod]
type = explod
trigger1 = AnimElem = 10
postype = p2
pos = 0, 5
sprpriority = -1
anim = 8200
persistent = 1

[State 3401, Explod]
type = explod
trigger1 = AnimElem = 10
postype = p2
pos = 0, 5
sprpriority = 6
anim = 8210
persistent = 1

[State 3401, Explod]
type = explod
triggerall = Time > 10
trigger1 = AnimElemTime(23) = 0
trigger2 = AnimElemTime(33) = 0
trigger3 = AnimElemTime(43) = 0
trigger4 = AnimElemTime(53) = 0
trigger5 = AnimElemTime(63) = 0
trigger6 = AnimElemTime(73) = 0
trigger7 = AnimElemTime(83) = 0
trigger8 = AnimElemTime(93) = 0
postype = p2
pos = -25,-5
bindtime = 1
sprpriority = 1
anim = 8020
ownpal = 1
ignorehitpause = 1

[State 3401, Explod]
type = explod
trigger1 = AnimElemTime(93) = 0
postype = p2
pos = -30, 5
sprpriority = -1
anim = 8200
persistent = 1

[State 3401, Explod]
type = explod
trigger1 = AnimElemTime(93) = 0
postype = p2
pos = -30, 5
sprpriority = 2
anim = 8210
persistent = 1

[State 3401, BgPalFx]
type = BgPalFx
trigger1 = MoveType = A	; Time = 0
time = 1	; 391	; 74
mul = 230, 230, 230
invertall = 1
ignorehitpause = 1

[State 3401, EnvColor]
type = EnvColor 
trigger1 = AnimElem = 10
trigger2 = AnimElem = 23
trigger3 = AnimElem = 33
trigger4 = AnimElem = 43
trigger5 = AnimElem = 53
trigger6 = AnimElem = 63
trigger7 = AnimElem = 73
trigger8 = AnimElem = 83
trigger9 = AnimElem = 93
time = 1
value = 255,255,255
under = 1
ignorehitpause = 0

[State 3502, AttackDist]
type = AttackDist
trigger1 = Time = 0
value = 0

[State 3502, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(100) = 0
movetype = I

[State 3401, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 相手1
;---------------------------------------------------------

[StateDef 3402]
type = L
movetype = H
physics = N
velset = 0, 0
ctrl = 0

[State 3402, SprPriority]
type = SprPriority
trigger1 = AnimElem = 5,< 0
value = -2

[State 3402, ChangeAnim2]
type = ChangeAnim2
trigger1 = Time = 0
value = 3402

[State 3402, ScreenBound]
type = ScreenBound
trigger1 = 1
movecamera = 1, 0
ignorehitpause = 1

[State 3402, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 3402, SelfState]
type = SelfState
trigger1 = AnimTime = 0
value = 5210
ctrl = 0

;---------------------------------------------------------
; 相手2
;---------------------------------------------------------

[StateDef 3403]
type = A
movetype = H
physics = N
velset = 0, 0
ctrl = 0

[State 3403, ChangeAnim2]
type = ChangeAnim2
trigger1 = Time = 0
value = 3403

[State 3403, VelSet]
type = VelSet
trigger1 = Time = 0
X = 4.7
Y = -9

[State 3403, VelAdd]
type = VelAdd
trigger1 = 1
y = .5

[State 3403, ScreenBound]
type = ScreenBound
trigger1 = 0
movecamera = 1, 0
ignorehitpause = 1

[State 3403, SelfState] 
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100

;===============================================================
; 時雨乱菊
;===============================================================
;---------------------------------------------------------
; 開始
;---------------------------------------------------------

[StateDef 3500]
type = S
movetype = A
physics = N
poweradd = ifelse(var(6), -1000, -3000)
velset = 0, 0
ctrl = 0
anim = 3500

[State 3500, VarSet]
type = VarSet
triggerall = Time = 0
trigger1 = PrevStateNo = 440
trigger2 = var(9) = 0 && (PrevStateNo = [200, 245])
trigger3 = PrevStateNo = 300 || PrevStateNo = 340
trigger4 = var(9) = 0 && ((PrevStateNo = [400, 440]) || PrevStateNo = 500)
trigger5 = PrevStateNo = 930
trigger6 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
var(8) = 8

; スーパーキャンセル時のゲージ消費
[State 3500, PowerAdd]
type = PowerAdd
triggerall = Time = 0
trigger1 = (PrevStateNo = [1000, 1999]) && PrevStateNo != 1422
value = -1000*!var(6)
persistent = 0

; 先行入力発動時の振り向き
[State 3500, Turn]
type = Turn
triggerall = Time <= 0
trigger1 = P2Dist X < 0

; パワーMAXモードの解除
[State 3500, VarSet]
type = VarSet
trigger1 = time = 0
fvar(0) = 0

[State 3500, HitDef]
type = HitDef
trigger1 = Time = 0
trigger1 = !var(20)
trigger1 = P2BodyDist X <= 30
attr = S, HT
hitflag = M
priority = 1, Miss
sparkno = -1	; s7777
p1facng = 1
p2facing = 1
;p1stateno = 3501
;p2stateno = 3503
fall = 1
fall.recover = 0
numhits = 0
hitsound = s810, 0
id = 3500
hitonce = 0

[State 3500, TargetState]
type = TargetState
triggerall = NumTarget(3500)
triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
trigger1 = AnimElemTime(2) <= 0
value = 3503
id = 3500
persistent = 0
ignorehitpause = 1

[State 3500, ChangeState]
type = ChangeState
triggerall = NumTarget(3500)
;triggerall = Target,MoveType = H && Target,StateNo >= 200 && !Target,ctrl
triggerall = Target,StateNo = 3503
trigger1 = AnimElemTime(2) <= 0
value = 3501
ctrl = 0
persistent = 0
ignorehitpause = 1

[State 3500, NotHitBy]
type = NotHitBy
trigger1 = Time = 0
value = SCA
time = 1
IgnoreHitPause = 1

[State 3500, AttackDist]
type = AttackDist
trigger1 = Time = 0
value = 0

[State 3500, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(2) = 0
movetype = I

[State 3500, VelSet]
type = VelSet
trigger1 = AnimElem = 2
X = 3

[State 3500, VelSet]
type = VelMul
trigger1 = AnimElemTime(7) > 0
X = 0.8

[State 3500, PlayerPush]
type = PlayerPush
trigger1 = AnimElemTime(5) >= 0
value = 0
ignorehitpause = 1

[State 3500, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 成功
;---------------------------------------------------------

[StateDef 3501]
type = S
movetype = A
physics = N
anim = 3501
poweradd = 0
velset = 0, 0

[State 3501, PlaySnd]
type = VelSet
trigger1 = Time = 0
x = 0
y = 0

[State 3501, Width]
type = Width
trigger1 = 1
player = 0

;貰った！
[State 3501, PlaySnd]
type = PlaySnd
trigger1 = Animelem = 1
value = s11, 2
channel = 0

[State 3501, EnvColor]
type = EnvColor
trigger1 = Time = 14
value = 248,248,248
under = 1
time = 4

[State 3501, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1
IgnoreHitPause = 1

[State 3501, ScreenBound]
type = ScreenBound
trigger1 = AnimElemTime(13) < 0
value = 0
movecamera = 0, 0	;1, 0
ignorehitpause = 1

[State 3501, ScreenBound]
type = ScreenBound
trigger1 = AnimElemTime(13) >= 0
value = 0
movecamera = 1, 0	;1, 0
ignorehitpause = 1

;背景の手前のレイヤーを非表示
[State 3501, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoFG
ignorehitpause = 1

[State 3501, VarSet]
type = VarSet
trigger1 = AnimElemTime(9) = 0
var(50) = Target,Const(size.head.pos.X)

[State 3501, VarSet]
type = VarAdd
trigger1 = AnimElemTime(9) = 0
var(50) = Target,Const(size.head.pos.Y) * 100000

[State 3501, Helper]
type = Helper
trigger1 = AnimElemTime(9) = 0
stateno = 8600
pausemovetime = 99999999999999
supermovetime = 99999999999999
ownpal = 1
persistent = 0

[State 3501, Helper]
type = Helper
trigger1 = AnimElemTime(9) = 0
id = 8520
pos = 70 + Target,Const(size.head.pos.X), -8 + Target,Const(size.head.pos.Y)	; 60, -95	; 30, -70
postype = P1
stateno = 8500
helpertype = normal
ownpal = 1
bindtime = -1
persistent = 0
pausemovetime = 99999999999999
supermovetime = 99999999999999

; スーパーポーズの判定
[State 3501, VarSet]
type = VarSet
trigger1 = AnimElemTime(9) = 0
var(13) = 28
ignorehitpause = 1
persistent = 0

[State 3501, SuperPause]
type = SuperPause
trigger1 = AnimElemTime(9) = 0
time = 28
anim = -1
sound = -1
darken = 0
p2defmul = 1
movetime = 28

[State 3501, BindToTarget]
type = BindtoTarget
trigger1 = NumTarget
trigger1 = AnimElemTime(9) >= 0
trigger1 = AnimElem = 9, <= 4
pos = -8, -7, head	; -8, -7

[State 3501, VelSet] 
type = VelSet
trigger1 = AnimElemTime(13) = 0
x = 0.5
y = 2

[State 3501, VelAdd]
type = VelAdd
trigger1 = AnimElemTime(13) > 0
x = .25	; .25
y = .22

[State 3501, AttackDist]
type = AttackDist
trigger1 = Time = 0
value = 0

[State 3501, ChangeState]
type = ChangeState
trigger1 = AnimElemTime(14) >= 0
trigger1 = Pos Y >= -50 && Vel Y > 0
value = 3502

;---------------------------------------------------------
; 着地
;---------------------------------------------------------

[StateDef 3502]
type = S
movetype = A
physics = S
anim = 3502
velset = 0, 0

[State 3502, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1
ignorehitpause = 1

[State 3502, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

;着地
[State 3502, PlaySnd]
type = PlaySnd
trigger1 = Animelem = 1
value = s52, 0

;いいぜ…
[State 3502, PlaySnd]
type = PlaySnd
trigger1 = Animelem = 4
value = s195, 0
channel = 0

;背景の手前のレイヤーを非表示
[State 3502, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoFG
ignorehitpause = 1

[State 3502, PosSet]
type = PosSet
trigger1 = Time = 0
Y = 0

[State 3502, BindToTarget]
type = BindToTarget
trigger1 = AnimElem = 1
pos = -60, 0	;-50,0

;…フッ
[State 3502, PlaSnd]
type = PlaySnd
trigger1 = Animelem = 30
value = s9, 1
channel = 0

;打ってこい！
[State 3502, PlaySnd]
type = PlaySnd
trigger1 = Animelem = 35
value = s195, 1
channel = 0

[State 3502, BindToTarget]
type = BindtoTarget
trigger1 = AnimElem = 30
pos = 80,0	; 60

[State 3502, TargetState]
type = TargetState
triggerall = NumTarget(3500)
triggerall = Target,StateNo != 3504
trigger1 = AnimElemTime(30) >= 0
value = 3504
id = 3500
persistent = 0

[State 3502, HitDef]
type = HitDef
trigger1 = AnimElem = 30
attr = S, HT
animtype = up
damage = floor(248 * (1 + (Target,Power * 100 / Target,PowerMax) * 0.01)), 8
hitflag = MAF+
pausetime = 0, 12	;32	; 32	; 24
sparkno = s8030
guard.sparkno = s8070
sparkxy = -10, -70
hitsound = s1, 4
guardsound = s2, 1
ground.type = high
air.slidetime = 16
air.hittime  = 20
ground.velocity = 0, 30	; -1, -10
air.velocity = 0, 30
fall = 1
fall.recover = 0
envshake.time = 12
envshake.ampl = -3
envshake.freq = 100
envshake.phase = -4
yaccel = .6
guard.dist = 0
;p2stateno = 3504
id = 3502
;numhits = 0
hitonce = 0

[State 3502, TargetState]
type = TargetState
triggerall = NumTarget(3502)
triggerall = Target,StateNo != 3505
trigger1 = AnimElemTime(31) >= 0
trigger1 = Target,HitShakeOver = 1
value = 3505
id = 3502
persistent = 0

[State 3502, TargetPowerAdd]
type = null	; TargetPowerAdd
trigger1 = NumTarget
trigger1 = AnimElem = 30
value = -1000

[State 3502, VarSet]
type = VarSet
trigger1 = var(2) != 2
trigger1 = time = 0
var(2) = 1

[State 3502, VarSet]
type = VarSet
trigger1 = var(3) != 2
trigger1 = time = 0
var(3) = 1

[State 3502, AttackDist]
type = AttackDist
trigger1 = Time = 0
value = 0

[State 3502, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(31) = 0
movetype = I

[State 3502, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------
; 相手
;---------------------------------------------------------

[StateDef 3503]
type = A
movetype = H
physics = N
velset = 0, 0

[State 3503, ScreenBound]
type = ScreenBound
trigger1 = 0
movecamera = 0, 0	;1, 0
ignorehitpause = 1

[State 3503, ChangeAnim2]
type = ChangeAnim2
trigger1 = Time = 0
value = 3503

[State 3503, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 3503, NotHitBy]
type = NotHitBy
trigger1 = Time < 120
value = SCA
time = 1
ignorehitpause = 1

[State 3503, HitBy]
type = HitBy
trigger1 = Time >= 120
value = S, HT
time = 1
ignorehitpause = 1

[State 3503, ChangeAnim]
type = ChangeAnim
trigger1 = Time = 41
trigger1 = AnimExist(5300)
value = 5300

[State 3503, ChangeAnim2]
type = ChangeAnim2
trigger1 = Time = 41
trigger1 = !AnimExist(5300)
value = 3503

[State 3503, ChangeAnim]
type = null	; Turn
trigger1 = Time = 41

[State 3503, SelfState]
type = SelfState
trigger1 = Time > 180
value = 5210
ctrl = 0

;---------------------------------------------------------
; 相手
;---------------------------------------------------------

[StateDef 3504]
type = A
movetype = H
physics = N
velset = 0, 0

[State 3504, Width]
type = Width
trigger1 = 1
player = 0, 0

[State 3504, HitBy]
type = HitBy
trigger1 = 1
value = S, HT
time = 1
ignorehitpause = 1

[State 3504, ChangeAnim2]
type = ChangeAnim2
trigger1 = Time = 0
value = 3503

[State 3504, SelfState]
type = SelfState
trigger1 = Time > 30
value = 5210
ctrl = 0

;---------------------------------------------------------------------------
; HIT_BOUNCE (hit ground)
[Statedef 3505]
type    = L
movetype= H
physics = N

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 7]
type = SelfState
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
value = 5110 ;HIT_LIEDOWN

[State 5100, 8]
type = null	; GameMakeAnim
trigger1 = Time = 1
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5100, 9]
type = HitFallDamage
trigger1 = Time = 3

[State 5100, 10]
type = null	; PlaySnd
trigger1 = Time = 1
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 3506	;5101

[State 5100, 13]
type = ForceFeedback
trigger1 = Time = 0
waveform = sinesquare
ampl = 128,-3,-.2,.005
time = 20

;---------------------------------------------------------------------------
; HIT_BOUNCE (bounce into air)
[Statedef 3506]
type    = L
movetype= H
physics = N

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 3507	;5110

;---------------------------------------------------------------------------
; HIT_LIEDOWN
[Statedef 3507]
type    = L
movetype= H
physics = N

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 6]
type = null	; PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 5110, 7]
type = null	; GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = Time > 120	; SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = time > 120	; SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = Time > 60	; SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5150

[State 5110, 11] ;If just died
type = SelfState
triggerall = alive
trigger1 = Time > 80	; SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5120

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 5110, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 5110, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

